[gd_scene load_steps=16 format=2]

[ext_resource path="res://assets/sprites/stages/backgroundPhase.png" type="Texture" id=1]
[ext_resource path="res://assets/sprites/stages/backgroundPlanet.png" type="Texture" id=2]
[ext_resource path="res://assets/sprites/stages/score.png" type="Texture" id=3]
[ext_resource path="res://assets/sprites/dumpsters/organic.png" type="Texture" id=4]
[ext_resource path="res://assets/sprites/dumpsters/glass.png" type="Texture" id=5]
[ext_resource path="res://assets/sprites/dumpsters/plastic.png" type="Texture" id=6]
[ext_resource path="res://assets/sprites/dumpsters/metal.png" type="Texture" id=7]
[ext_resource path="res://assets/sprites/dumpsters/paper.png" type="Texture" id=8]
[ext_resource path="res://assets/sprites/stages/config.png" type="Texture" id=9]
[ext_resource path="res://assets/sprites/planets/happy.png" type="Texture" id=10]
[ext_resource path="res://assets/fonts/LemonMilklight.otf" type="DynamicFontData" id=11]
[ext_resource path="res://scenes/global.gd" type="Script" id=12]

[sub_resource type="GDScript" id=1]
script/source = "extends Node

const new_soda = preload(\"res://scenes/trashs/metal/soda.tscn\")

const new_bottle = preload(\"res://scenes/trashs/glass/bottle.tscn\")

const new_paper = preload(\"res://scenes/trashs/paper/paper.tscn\")
const new_paper_ball = preload(\"res://scenes/trashs/paper/paperBall.tscn\")

const new_apple = preload(\"res://scenes/trashs/organic/apple.tscn\")
const new_banana = preload(\"res://scenes/trashs/organic/banana.tscn\")
const new_snack = preload(\"res://scenes/trashs/organic/snack.tscn\")

const new_bag = preload(\"res://scenes/trashs/plastic/bag.tscn\")
const new_bowl = preload(\"res://scenes/trashs/plastic/bowl.tscn\")
const new_glass = preload(\"res://scenes/trashs/plastic/glassPlastic.tscn\")

const planet_worried = preload(\"res://assets/sprites/planets/worried.png\")
const planet_sad = preload(\"res://assets/sprites/planets/sad.png\")
const planet_dead = preload(\"res://assets/sprites/planets/dead.png\")

onready var planet_sprite = get_node(\"planet/planet\");

onready var label_points = get_node(\"bar/points\");

onready var lifeOne = get_node(\"bar/lifeOne\");
onready var lifeTwo = get_node(\"bar/lifeTwo\");
onready var lifeThree = get_node(\"bar/lifeThree\");

onready var levelOne = get_node(\"level1\");
onready var levelTwo = get_node(\"level2\");
onready var levelThree = get_node(\"level3\");

const trashs = [
	new_soda, new_bottle, new_paper,
	new_paper_ball, new_apple, new_banana,
	new_snack, new_bag, new_bowl, new_glass
];

const humor_planet = [planet_worried, planet_sad, planet_dead];

var points = 0.0;
var points_missed = 1;

func restart():
	points = 0.0;
	points_missed = 0;
	global.current_id = '';
	pass
	
func kill_planet():
	if points_missed == 5:
		planet_sprite.set_texture(planet_worried);
		lifeThree.hide()
	elif points_missed == 10:
		planet_sprite.set_texture(planet_sad);
		lifeTwo.hide()
	elif points_missed == 15:
		planet_sprite.set_texture(planet_dead);
		lifeOne.hide()
		game_over();
	pass

func game_over():
# warning-ignore:return_value_discarded
	get_tree().change_scene(\"res://scenes/menu.tscn\")
	pass
	
func hit():
	points = points+10;
	label_points.set_text(String(points/1000)+\" K\")
	pass
	
func miss():
	points_missed = points_missed + 1;
	print(String(points_missed))
	if points_missed % 5 == 0:
		kill_planet()
	pass

func _ready():
	restart();
	pass

func spawn_trash():
	var trash = trashs[int(rand_range(0, trashs.size() - 1))].instance();
	trash.position.x = int(rand_range(0, 600))
	trash.position.y = 0
	get_node('container').add_child(trash)
	pass

func _on_plasticTrash_area_entered(area):
	if area.name.ends_with('Plastic'):
		hit()
	else:
		miss()
	pass 

func _on_metalTrash_area_entered(area):
	if area.name.ends_with('Metal'):
		hit()
	else:
		miss()
	pass 

func _on_paperTrash_area_entered(area):
	if area.name.ends_with('Paper'):
		hit()
	else:
		miss()
	pass 

func _on_glassTrash_area_entered(area):
	if area.name.ends_with('Glass'):
		hit()
	else:
		miss()
	pass 

func _on_organicTrash_area_entered(area):
	if area.name.ends_with('Organic'):
		hit()
	else:
		miss()
	pass


func _on_level1_timeout():
	if int(points) == 300:
		levelOne.stop();
		levelTwo.start();
	spawn_trash()
	pass


func _on_level2_timeout():	
	if int(points) == 900:
		levelTwo.stop()
		levelThree.start();
	spawn_trash()
	pass


func _on_level3_timeout():
	spawn_trash()
	pass
"

[sub_resource type="CapsuleShape2D" id=2]
radius = 69.496
height = 128.521

[sub_resource type="DynamicFont" id=3]
size = 31
outline_size = 1
font_data = ExtResource( 11 )

[node name="main" type="Node"]
script = SubResource( 1 )

[node name="backgrounds" type="Node2D" parent="."]

[node name="main" type="Sprite" parent="backgrounds"]
position = Vector2( 360.42, 511.555 )
scale = Vector2( 0.768741, 0.679974 )
texture = ExtResource( 1 )

[node name="planet" type="Sprite" parent="backgrounds"]
position = Vector2( 357.946, 1152.27 )
scale = Vector2( 0.668316, 0.662877 )
z_index = 1
texture = ExtResource( 2 )

[node name="score" type="Sprite" parent="backgrounds"]
position = Vector2( 119.583, 1128.86 )
scale = Vector2( 0.5, 0.5 )
z_index = 2
texture = ExtResource( 3 )

[node name="dumpsters" type="Node" parent="."]
editor/display_folded = true

[node name="organicTrash" type="Node2D" parent="dumpsters"]
editor/display_folded = true

[node name="organic" type="Sprite" parent="dumpsters/organicTrash"]
position = Vector2( 67.848, 980 )
scale = Vector2( 0.75, 0.75 )
texture = ExtResource( 4 )

[node name="organicTrash" type="Area2D" parent="dumpsters/organicTrash"]

[node name="colisionOrganic" type="CollisionShape2D" parent="dumpsters/organicTrash/organicTrash"]
position = Vector2( 68.332, 1007 )
shape = SubResource( 2 )

[node name="glassTrash" type="Node2D" parent="dumpsters"]
editor/display_folded = true

[node name="glass" type="Sprite" parent="dumpsters/glassTrash"]
position = Vector2( 212.291, 980 )
scale = Vector2( 0.75, 0.75 )
texture = ExtResource( 5 )

[node name="glassTrash" type="Area2D" parent="dumpsters/glassTrash"]

[node name="colisionGlass" type="CollisionShape2D" parent="dumpsters/glassTrash/glassTrash"]
position = Vector2( 212.765, 1007 )
shape = SubResource( 2 )

[node name="plasticTrash" type="Node2D" parent="dumpsters"]
editor/display_folded = true

[node name="plastic" type="Sprite" parent="dumpsters/plasticTrash"]
position = Vector2( 357.337, 980 )
scale = Vector2( 0.75, 0.75 )
texture = ExtResource( 6 )

[node name="plasticTrash" type="Area2D" parent="dumpsters/plasticTrash"]

[node name="colisionPlastic" type="CollisionShape2D" parent="dumpsters/plasticTrash/plasticTrash"]
position = Vector2( 357.916, 1007 )
shape = SubResource( 2 )

[node name="metalTrash" type="Node2D" parent="dumpsters"]
editor/display_folded = true

[node name="metal" type="Sprite" parent="dumpsters/metalTrash"]
position = Vector2( 505.28, 980 )
scale = Vector2( 0.75, 0.75 )
texture = ExtResource( 7 )

[node name="metalTrash" type="Area2D" parent="dumpsters/metalTrash"]

[node name="colisionMetal" type="CollisionShape2D" parent="dumpsters/metalTrash/metalTrash"]
position = Vector2( 504.863, 1007 )
shape = SubResource( 2 )

[node name="paperTrash" type="Node2D" parent="dumpsters"]
editor/display_folded = true

[node name="paper" type="Sprite" parent="dumpsters/paperTrash"]
position = Vector2( 651.232, 980 )
scale = Vector2( 0.75, 0.75 )
texture = ExtResource( 8 )

[node name="paperTrash" type="Area2D" parent="dumpsters/paperTrash"]
editor/display_folded = true

[node name="colisionPaper" type="CollisionShape2D" parent="dumpsters/paperTrash/paperTrash"]
position = Vector2( 650.41, 1007 )
shape = SubResource( 2 )

[node name="container" type="Node" parent="."]

[node name="config" type="Node2D" parent="."]
editor/display_folded = true

[node name="Sprite" type="Sprite" parent="config"]
modulate = Color( 0.662745, 0.662745, 0.662745, 1 )
position = Vector2( 619.44, 1155.17 )
z_index = 2
texture = ExtResource( 9 )

[node name="planet" type="Node2D" parent="."]
editor/display_folded = true

[node name="planet" type="Sprite" parent="planet"]
position = Vector2( 367.03, 1151.44 )
scale = Vector2( 0.55, 0.55 )
z_index = 2
texture = ExtResource( 10 )

[node name="bar" type="Node2D" parent="."]
editor/display_folded = true
z_index = 2

[node name="lifeOne" type="Sprite" parent="bar"]
position = Vector2( 45.658, 50 )
scale = Vector2( 0.2, 0.2 )
z_index = 1
texture = ExtResource( 10 )

[node name="lifeTwo" type="Sprite" parent="bar"]
position = Vector2( 250.519, 94.5125 )
scale = Vector2( 0.2, 0.2 )
z_index = 1
texture = ExtResource( 10 )
offset = Vector2( -606.383, -220 )

[node name="lifeThree" type="Sprite" parent="bar"]
position = Vector2( 212.043, 50 )
scale = Vector2( 0.2, 0.2 )
z_index = 1
texture = ExtResource( 10 )

[node name="points" type="Label" parent="bar"]
anchor_right = 0.65
margin_left = 63.5161
margin_top = 1126.71
margin_right = 163.516
margin_bottom = 1174.71
rect_rotation = -23.74
custom_fonts/font = SubResource( 3 )
text = "0.00 K"
align = 1
valign = 1
autowrap = true

[node name="global" type="Node2D" parent="."]
script = ExtResource( 12 )

[node name="level1" type="Timer" parent="."]
wait_time = 1.5
autostart = true

[node name="level3" type="Timer" parent="."]
wait_time = 0.8

[node name="level2" type="Timer" parent="."]
wait_time = 1.1
[connection signal="area_entered" from="dumpsters/organicTrash/organicTrash" to="." method="_on_organicTrash_area_entered"]
[connection signal="area_entered" from="dumpsters/glassTrash/glassTrash" to="." method="_on_glassTrash_area_entered"]
[connection signal="area_entered" from="dumpsters/plasticTrash/plasticTrash" to="." method="_on_plasticTrash_area_entered"]
[connection signal="area_entered" from="dumpsters/metalTrash/metalTrash" to="." method="_on_metalTrash_area_entered"]
[connection signal="area_entered" from="dumpsters/paperTrash/paperTrash" to="." method="_on_paperTrash_area_entered"]
[connection signal="texture_changed" from="planet/planet" to="." method="_on_planet_texture_changed"]
[connection signal="timeout" from="level1" to="." method="_on_level1_timeout"]
[connection signal="timeout" from="level3" to="." method="_on_level3_timeout"]
[connection signal="timeout" from="level2" to="." method="_on_level2_timeout"]
